<!doctype html><html><head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge"><title>How to run Xcode tests for a SwiftUI iOS codebase with GitHub Actions - Thomas Wilson</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Tl;dr
 Make sure you&rsquo;ve got a repo on GitHub. Make sure you&rsquo;ve got at least one set of tests in your Xcode codebase. Create the file below in yourproject/.github/workflows/main.yml: Replace the yourprojects and YourProjects with your file name git add .github/workflows/main.yml && git commit -m &#34;Add test GitHub action&#34; && git push  # Run My App's tests whenever someone pushes to `main` or creates a PR into `main` name: CI on: # Triggers the workflow on push or pull request events but only for the main branch.">
<meta property="og:image" content>
<meta property="og:title" content="How to run Xcode tests for a SwiftUI iOS codebase with GitHub Actions">
<meta property="og:description" content="Tl;dr
 Make sure you&rsquo;ve got a repo on GitHub. Make sure you&rsquo;ve got at least one set of tests in your Xcode codebase. Create the file below in yourproject/.github/workflows/main.yml: Replace the yourprojects and YourProjects with your file name git add .github/workflows/main.yml && git commit -m &#34;Add test GitHub action&#34; && git push  # Run My App's tests whenever someone pushes to `main` or creates a PR into `main` name: CI on: # Triggers the workflow on push or pull request events but only for the main branch.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://thomaswilson.xyz/blog/2021-02-27-github-actions-xcode-tests/"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2021-02-27T00:00:00+00:00">
<meta property="article:modified_time" content="2021-02-27T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="How to run Xcode tests for a SwiftUI iOS codebase with GitHub Actions">
<meta name=twitter:description content="Tl;dr
 Make sure you&rsquo;ve got a repo on GitHub. Make sure you&rsquo;ve got at least one set of tests in your Xcode codebase. Create the file below in yourproject/.github/workflows/main.yml: Replace the yourprojects and YourProjects with your file name git add .github/workflows/main.yml && git commit -m &#34;Add test GitHub action&#34; && git push  # Run My App's tests whenever someone pushes to `main` or creates a PR into `main` name: CI on: # Triggers the workflow on push or pull request events but only for the main branch.">
<script src=https://thomaswilson.xyzjs/feather.min.js></script>
<link href=/css/fonts.511ddb4c3eb5cc664ffce964174cebefda4d808569e219a7e5188466aa7713e6.css rel=stylesheet>
<link rel=stylesheet type=text/css media=screen href=/css/main.ecd799717c3d0b98bb2dca9498befc813ebe08241cce8dece74ccadb7dadced1.css>
<link id=darkModeStyle rel=stylesheet type=text/css href=/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css media="(prefers-color-scheme: dark)">
</head>
<body>
<div class=content><header>
<div class=main>
<a href=https://thomaswilson.xyz>Thomas Wilson</a>
</div>
<nav>
<a href=/blog>Blog</a>
<a href=/book-reviews>Book reviews</a>
</nav>
</header>
<main>
<article>
<div class=title>
<h1 class=title>How to run Xcode tests for a SwiftUI iOS codebase with GitHub Actions</h1>
<div class=meta>Posted on Feb 27, 2021</div>
</div>
<section class=body>
<p>Tl;dr</p>
<ol>
<li>Make sure you&rsquo;ve got a repo on GitHub.</li>
<li>Make sure you&rsquo;ve got at least one set of tests in your Xcode codebase.</li>
<li>Create the file below in <code>yourproject/.github/workflows/main.yml</code>:</li>
<li>Replace the <code>yourproject</code>s and <code>YourProject</code>s with your file name</li>
<li><code>git add .github/workflows/main.yml && git commit -m "Add test GitHub action" && git push</code></li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#75715e># Run My App&#39;s tests whenever someone pushes to `main` or creates a PR into `main`</span>

<span style=color:#f92672>name</span>: <span style=color:#ae81ff>CI</span>

<span style=color:#f92672>on</span>:
  <span style=color:#75715e># Triggers the workflow on push or pull request events but only for the main branch.</span>
  <span style=color:#f92672>push</span>:
    <span style=color:#f92672>branches</span>: [ <span style=color:#ae81ff>main ]</span>
  <span style=color:#f92672>pull_request</span>:
    <span style=color:#f92672>branches</span>: [ <span style=color:#ae81ff>main ]</span>

<span style=color:#75715e># We&#39;re only going to have one job, `test` but you can add this</span>
<span style=color:#f92672>jobs</span>:
  <span style=color:#f92672>test</span>:
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>macOS-latest</span>
    <span style=color:#f92672>steps</span>:
	    <span style=color:#75715e># Checkout the code to the working directory</span>
      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
      <span style=color:#75715e># Install xcbeautify so the logs are human-friendly</span>
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>install xcbeautify</span>
        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>brew install xcbeautify</span>
	    <span style=color:#75715e># Run the tests</span>
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Run the xcode tests</span>
        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>xcodebuild clean test -project YourProject.xcodeproj -scheme YourProject -destination &#34;platform=iOS Simulator,name=iPhone 12&#34; | xcbeautify</span>


</code></pre></div><h2 id=what-are-github-actions>What are Github Actions</h2>
<p>They&rsquo;re bits of code you write which are executed whenever <em>something</em> happens on your GitHub repo. These bits of code can do whatever (they&rsquo;re just functions that run on a container), like:</p>
<ol>
<li>Run the tests in your repo (what we&rsquo;ll be doing today)</li>
<li>Build an artefact from source code then publish that to a directory</li>
<li>Send out an e-mail or hit a web-hook whenever something happens</li>
<li>Build your static site and upload it to S3, GitHub pages, or wherever.</li>
</ol>
<p>If you&rsquo;ve used other tools, GitHub actions are like TeamCity, CircleCI, Jenkins, or any other CI/CD pipeline tool, but built right into GitHub. If you&rsquo;ve not heard of, or used those tools, <a href=#do-it-locally>I explain a bit more about it below</a>.</p>
<h2 id=the-working-parts>The working parts</h2>
<p>We don&rsquo;t actually write &ldquo;actions&rdquo;, we write <strong>workflows</strong>, which contain one or more <strong>jobs</strong>, which contain one or more <strong>steps</strong>.</p>
<p>The details for a single workflow is written in <a href=https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html>yaml</a>, as common plaintext format used by a lot of DevOps tools.</p>
<p>We put the yaml file in <code>yourproject/.github/workflows/workflow-name.yml</code> where <code>yourproject</code> is the root directory of your project and <code>workflow-name</code> is the name you wish to give the workflow.</p>
<p>There are three root-level yaml properties we&rsquo;re going to set:</p>
<ol>
<li><code>name</code> Is the human-readable name for the entire workflow. Call this &ldquo;CI&rdquo; or &ldquo;Run all tests&rdquo; or &ldquo;Send e-mail&rdquo;.</li>
<li><code>on</code> configures what exactly needs to happen for this workflow to run. By default, every job and step will run on every event.</li>
<li><code>jobs</code> Is a list of the jobs we&rsquo;ll be doing. In this example there&rsquo;s just one: running the tests</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>name</span>: <span style=color:#ae81ff>CI</span>
<span style=color:#f92672>on</span>:
  <span style=color:#75715e># Triggers the workflow on push or pull request events but only for the main branch.</span>
  <span style=color:#f92672>push</span>:
    <span style=color:#f92672>branches</span>: [<span style=color:#ae81ff>main]</span>
  <span style=color:#f92672>pull_request</span>:
    <span style=color:#f92672>branches</span>: [<span style=color:#ae81ff>main]</span>
<span style=color:#f92672>jobs</span>:
<span style=color:#f92672>test</span>:
<span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>macOS-latest</span>
</code></pre></div><p>Not how we&rsquo;re telling the <code>test</code> job that we&rsquo;re going to run on <code>macOS-latest</code>. Github gets us a container running that environment, which is cool.</p>
<h3 id=checking-out-the-code-so-we-can-access-it-in-our-tests>Checking out the code so we can access it in our tests</h3>
<p>By default, a job in a GitHub action just gives us an empty container, so we need to tell it to copy the code into our current working directory.</p>
<p>There&rsquo;s an easy way to do that: the <code>checkout</code> action is a third-party GitHub action that checks out our current working branch to the current working directory. <a href=https://github.com/actions/checkout>Here are the Checkout docs</a>.</p>
<p>By adding the following we make sure we have access to our code:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>jobs</span>:
  <span style=color:#f92672>test</span>:
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>macOS-latest</span>
    <span style=color:#f92672>steps</span>:
	    <span style=color:#75715e># Checkout the code to the working directory</span>
      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
</code></pre></div><h3 id=installing-xcbeautify>Installing xcbeautify</h3>
<p>The default Xcode logs are horrible: they&rsquo;re verbose and unintelligible. Xcbeautify is a CLI tool that formats them to give us more readable useful information.</p>
<p>Luckily the <code>macOS-latest</code> platform comes with homebrew, the MacOS package manager, already installed, so we just need to tell our <code>test</code> job to install it:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>jobs</span>:
  <span style=color:#f92672>test</span>:
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>macOS-latest</span>
    <span style=color:#f92672>steps</span>:
	    <span style=color:#75715e># Checkout the code to the working directory</span>
      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Install xcbeautify</span>
	      <span style=color:#f92672>run</span>: <span style=color:#ae81ff>brew install xcbeautify</span>
</code></pre></div><p>This step in our job has two things:</p>
<ol>
<li><code>name</code> is a human-readable name, useful for us and the UI in GitHub</li>
<li><code>run</code> is the thing you want to type onto the CLI. When that&rsquo;s done, the job will move on to the next step</li>
</ol>
<h3 id=run-the-test>Run the Test</h3>
<p>The last step in the job is to run the tests using the <code>xcodebuild</code> CLI tool. This is actually pretty easy and simple, just make sure you clean-up the names and details in the script below.</p>
<p>Node how we&rsquo;re <strong>piping</strong> (i.e. the <code>|</code> character) the results from <code>xcodebuild</code> through the <code>xcbeautiful</code> command. That&rsquo;s a unix-ism, it&rsquo;s pretty powerful (or so I&rsquo;m told, I&rsquo;m just a frontend engineer here).</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>jobs</span>:
  <span style=color:#f92672>test</span>:
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>macOS-latest</span>
    <span style=color:#f92672>steps</span>:
	    <span style=color:#75715e># Checkout the code to the working directory</span>
      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
      <span style=color:#75715e># Install xcbeautify so the logs are human-friendly</span>
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>install xcbeautify</span>
        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>brew install xcbeautify</span>
	    <span style=color:#75715e># Run the tests</span>
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Run the xcode tests</span>
        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>xcodebuild clean test -project YourProject.xcodeproj -scheme YourProject -destination &#34;platform=iOS Simulator,name=iPhone 12&#34; | xcbeautify</span>
</code></pre></div><h3 id=commit-baby>Commit, baby</h3>
<p>You&rsquo;re good to go, let&rsquo;s add the file we made to our git repo, make a single commit and push it up <code>git add .github/workflows/main.yml && git commit -m "Add test GitHub action" && git push</code></p>
<p>(We&rsquo;re assuming the <code>main.yml</code> file is the one you made, if you called it something different, change that).</p>
<h3 id=go-check-github>Go check GitHub</h3>
<p>Go to your GitHub repo, click the &ldquo;Actions&rdquo; tab, and watch with glee.</p>
<p>You can. If you already know why, you can skip this section.</p>
<p>I come from a frontend engineering background, where having test coverage has typically been difficult or different to the backend world. So answering this question is as much about learning facts/words as it is about understanding that the software design, development, and deploy process can be different. I know. I&rsquo;m sure some engineers are tutting or shaking their heads at me. TUT AWAY, FRIENDS I&rsquo;m standing in my truth here.</p>
<p>GitHub&rsquo;s actions are part of a broader practice of CI/CD (continuous integration and delivery) in software. The idea of CI/CD is to commit code frequently, and have automated processes in place to detect the introduction of errors to the codebase.</p>
<p>CI/CD can also automate any other previously manual processes, like building, deploying, or publishing software. The roles of CI/CD and automation can grow and expand as your team or product become more complicated. In this example we&rsquo;re just using it to run tests because <strong>well written tests give you confidence that your code does what you think it does</strong>.</p>
<p>As teams grow, having actions run automatically means that institutional and team policies (like having all tests pass before anything goes into <code>main</code>, formatting code, running a smoke-test before publish) are adhered to without manual intervention. This reduces the barrier to actually publishing code.</p>
<p>Integrating the CI/CD pipeline right where your code is hosted is different to having a third-party service watch your git repo. It&rsquo;s first-party and also probably cheaper (maybe).</p>
<p>GitHub actions are versatile &ldquo;something&rdquo; that triggers these bits of code to run can be:</p>
<ol>
<li>Someone pushes to your <code>main</code> branch</li>
<li>Someone opens, closes, or comments on an issue</li>
<li>Someone creates a PR from any branch to any branch</li>
</ol>
<p>For a full list, see Github&rsquo;s <a href=https://docs.github.com/en/actions/reference/events-that-trigger-workflows>full list of events</a> that can trigger a workflow.</p>
</section>
<div class=post-tags>
<nav class="nav tags">
<ul class=tags>
<li><a href=/tags/swift>swift</a></li>
<li><a href=/tags/github-actions>github-actions</a></li>
</ul>
</nav>
</div>
</article>
</main>
<footer>
<hr>
2021
© Thomas Wilson
</footer>
</div>
</body>
</html>